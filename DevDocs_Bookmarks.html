<!DOCTYPE html>
<html lang="vi" data-theme="auto">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DevDocs Portal ‚Äî EN‚ÄìVI (v3)</title>
<meta name="description" content="C·ªïng tri th·ª©c l·∫≠p tr√¨nh song ng·ªØ, VS Code-style, PWA offline.">
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='128' height='128'%3E%3Crect width='100%25' height='100%25' rx='24' ry='24' fill='%231f6feb'/%3E%3Ctext x='50%25' y='57%25' text-anchor='middle' font-family='Inter, Arial' font-size='70' fill='white'%3EDD%3C/text%3E%3C/svg%3E">
<meta name="theme-color" content="#1f6feb"/>

<style>
  /* ===== THEME TOKENS ===== */
  :root{
    --bg:#ffffff; --fg:#24292e; --muted:#57606a; --card:#f6f8fa; --link:#0969da; --border:#d0d7de; --accent:#1f6feb; --shadow:rgba(27,31,35,0.08);
    --danger:#dc2626; --warn:#d97706; --ok:#16a34a; --glass:rgba(246,248,250,0.75);
    --code-bg:#f6f8fa; --code-fg:#24292e; --sidebar:#f3f4f6; --sidebar-border:#e5e7eb;
  }
  @media (prefers-color-scheme: dark){
    :root{
      --bg:#0d1117; --fg:#c9d1d9; --muted:#8b949e; --card:#161b22; --link:#58a6ff; --border:#30363d; --accent:#1f6feb; --shadow:rgba(1,4,9,0.35);
      --danger:#ef4444; --warn:#f59e0b; --ok:#22c55e; --glass:rgba(13,17,23,0.55);
      --code-bg:#0d1117; --code-fg:#c9d1d9; --sidebar:#0f141b; --sidebar-border:#22272e;
    }
  }

  html[data-theme="light"]{ --bg:#ffffff; --fg:#24292e; --muted:#57606a; --card:#f6f8fa; --link:#0969da; --border:#d0d7de; --accent:#1f6feb; --shadow:rgba(27,31,35,0.08); --glass:rgba(246,248,250,0.75); --code-bg:#f6f8fa; --code-fg:#24292e; --sidebar:#f3f4f6; --sidebar-border:#e5e7eb;}
  html[data-theme="dark"]{ --bg:#0d1117; --fg:#c9d1d9; --muted:#8b949e; --card:#161b22; --link:#58a6ff; --border:#30363d; --accent:#1f6feb; --shadow:rgba(1,4,9,0.35); --glass:rgba(13,17,23,0.55); --code-bg:#0d1117; --code-fg:#c9d1d9; --sidebar:#0f141b; --sidebar-border:#22272e;}
  html[data-theme="vscode"]{ --bg:#0e1114; --fg:#d4d4d4; --muted:#9da3ae; --card:#11151a; --link:#4fc1ff; --border:#2a2f36; --accent:#3ea6ff; --shadow:rgba(0,0,0,0.35); --glass:rgba(17,21,26,0.55); --code-bg:#0b0f14; --code-fg:#d4d4d4; --sidebar:#0c1015; --sidebar-border:#20242a;}
  html[data-theme="hacker"]{ --bg:#050505; --fg:#d0ffd0; --muted:#80c080; --card:#0a0f0a; --link:#00ff99; --border:#113311; --accent:#00e676; --shadow:rgba(0,255,153,0.15); --glass:rgba(10,15,10,0.55); --code-bg:#0a0f0a; --code-fg:#d0ffd0; --sidebar:#070d07; --sidebar-border:#0e1d0e;}
  html[data-theme="solarized"]{ --bg:#fdf6e3; --fg:#073642; --muted:#657b83; --card:#eee8d5; --link:#268bd2; --border:#d3c6a6; --accent:#2aa198; --shadow:rgba(0,0,0,0.08); --glass:rgba(253,246,227,0.7); --code-bg:#eee8d5; --code-fg:#073642; --sidebar:#f3ecd3; --sidebar-border:#e3d7b3;}
  html[data-theme="monokai"]{ --bg:#272822; --fg:#f8f8f2; --muted:#a6e22e; --card:#2d2e28; --link:#66d9ef; --border:#3c3d36; --accent:#fd971f; --shadow:rgba(0,0,0,0.4); --glass:rgba(39,40,34,0.65); --code-bg:#2d2e28; --code-fg:#f8f8f2; --sidebar:#22231e; --sidebar-border:#35362f;}

  /* New themes */
  html[data-theme="dracula"]{ --bg:#282a36; --fg:#f8f8f2; --muted:#bd93f9; --card:#2f3241; --link:#8be9fd; --border:#3b3e4c; --accent:#ff79c6; --shadow:rgba(0,0,0,0.45); --glass:rgba(40,42,54,0.6); --code-bg:#2f3241; --code-fg:#f8f8f2; --sidebar:#222433; --sidebar-border:#34364a;}
  html[data-theme="nord"]{ --bg:#2e3440; --fg:#eceff4; --muted:#81a1c1; --card:#3b4252; --link:#88c0d0; --border:#434c5e; --accent:#5e81ac; --shadow:rgba(0,0,0,0.45); --glass:rgba(46,52,64,0.6); --code-bg:#3b4252; --code-fg:#eceff4; --sidebar:#2b303b; --sidebar-border:#3b4252;}

  /* ===== BASE ===== */
  *{box-sizing:border-box}
  html, body { height:100% }
  body{
    margin:0; background:var(--bg); color:var(--fg);
    font-family: Inter, ui-sans-serif, System-ui, Segoe UI, Roboto, Arial;
    line-height:1.65;
    transition: background-color .25s ease, color .25s ease;
  }
  a{ color:var(--link); text-decoration:none; transition: color .2s ease }
  .btn,.select{
    appearance:none; border:1px solid var(--border); background:var(--card); color:var(--fg);
    padding:8px 10px; border-radius:10px; font-size:14px; cursor:pointer; transition:border-color .2s ease, transform .08s ease;
  }
  .btn:hover,.select:hover{ border-color:var(--muted) }
  .btn:active{ transform:translateY(1px) }
  .chip{ border:1px solid var(--border); color:var(--muted); padding:4px 8px; border-radius:999px; font-size:12px }

  /* ===== HEADER ===== */
  header{
    position:sticky; top:0; z-index:40; background:var(--glass);
    border-bottom:1px solid var(--border); backdrop-filter: blur(8px);
  }
  .container{ max-width:1240px; margin:0 auto; padding:12px 16px }
  .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
  .logo{ width:32px; height:32px; border-radius:8px; background:var(--accent); color:#fff; display:grid; place-items:center; font-weight:800; box-shadow:0 2px 10px var(--shadow) }
  h1{ font-size:20px; margin:0 } .subtitle{ color:var(--muted); font-size:13px }

  .toolbar{
    display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;
    background: var(--glass); border:1px solid var(--border); border-radius:12px;
    padding:10px; backdrop-filter: blur(8px);
  }
  .search{ flex:1 1 380px; display:flex; gap:8px; align-items:center;
    background:var(--card); border:1px solid var(--border); border-radius:10px; padding:8px 10px }
  .search input{ flex:1; border:none; outline:none; background:transparent; color:var(--fg); font-size:14px }

  /* ===== LAYOUT: SIDEBAR + MAIN ===== */
  .app{ display:grid; grid-template-columns: 260px 1fr 420px; gap:12px; padding:14px 16px }
  .sidebar{
    background:var(--sidebar); border:1px solid var(--sidebar-border); border-radius:12px; box-shadow:0 4px 16px var(--shadow);
    padding:10px; position:sticky; top:92px; height: calc(100vh - 110px); overflow:auto;
  }
  .main{ min-width: 320px }
  .right{ min-width: 300px; display:flex; flex-direction:column; gap:12px }

  .s-title{ font-size:13px; color:var(--muted); margin:6px 8px }
  .group-btn{
    width:100%; text-align:left; background:transparent; border:1px solid transparent; border-radius:8px;
    padding:8px 10px; display:flex; align-items:center; gap:8px; color:var(--fg); cursor:pointer;
  }
  .group-btn.active, .group-btn:hover{ background:var(--card); border-color:var(--border) }

  .panel{ background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:0 4px 16px var(--shadow) }
  .panel h3{ margin:0; padding:10px 12px; border-bottom:1px solid var(--border); font-size:14px }
  .panel-body{ padding:12px 14px }

  details.group{
    border:1px solid var(--border); border-radius:12px; margin-bottom:12px; background:var(--card); box-shadow:0 3px 12px var(--shadow);
    overflow:hidden; transition: box-shadow .25s ease;
  }
  details.group>summary{
    list-style:none; user-select:none; padding:12px 14px; cursor:pointer; font-weight:600; display:flex; align-items:center; justify-content:space-between;
  }
  details[open]>.accordion{ max-height:800px; opacity:1 }
  .accordion{ max-height:0; opacity:0; overflow:hidden; transition:max-height .35s ease, opacity .25s ease }
  .links{ padding:10px 14px; display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:6px 16px }

  .item{ display:flex; align-items:center; gap:8px; padding:6px 0 }
  .item img.favico{ width:16px; height:16px; border-radius:4px; border:1px solid var(--border); background:var(--bg) }
  .meta{ color:var(--muted); font-size:12px }

  .star{ cursor:pointer; opacity:.7; transition: transform .08s ease, opacity .2s ease }
  .star:hover{ opacity:1; transform: scale(1.05) }
  .star.active{ color:#f59e0b }

  .tooltip{ position:fixed; z-index:70; pointer-events:none; background:var(--card); border:1px solid var(--border); border-radius:10px; padding:8px 10px; color:var(--fg); font-size:12px; box-shadow:0 8px 30px var(--shadow); max-width:320px; display:none }

  /* Preview */
  .preview-wrap{ position:relative }
  iframe{ width:100%; height:60vh; border:none; border-top:1px solid var(--border) }
  .spinner{ position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:linear-gradient(to bottom, transparent, rgba(0,0,0,.06)) }
  .spinner::after{ content:""; width:28px; height:28px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:999px; animation:spin 1s linear infinite }
  @keyframes spin { to { transform: rotate(360deg) } }

  .note-area{ width:100%; min-height:140px; background:var(--bg); color:var(--fg); border:1px solid var(--border); border-radius:10px; padding:10px; font-family: ui-monospace, Consolas, Menlo, monospace }

  .stats{ display:flex; flex-wrap:wrap; gap:8px }
  .stat{ background:var(--card); border:1px solid var(--border); border-radius:10px; padding:8px 10px; font-size:12px }

  /* Zen floating button */
  #zenBtn{
    position: fixed; right: 12px; bottom: 12px; z-index: 100;
    background: var(--accent); color:white; border:none; box-shadow:0 4px 16px var(--shadow);
  }
  body.zen header, body.zen .toolbar, body.zen .right{ display:none !important }
  body.zen .app{ grid-template-columns: 260px 1fr; }
  body.zen #zenBtn{ background: var(--warn) }

  /* Command Palette */
  .cmdp{
    position: fixed; inset:0; display:none; align-items:flex-start; justify-content:center; padding-top:10vh; z-index:90;
    background: rgba(0,0,0,.35);
  }
  .cmdp .box{
    width: min(780px, 94vw); background: var(--card); border:1px solid var(--border); border-radius:12px; box-shadow:0 12px 36px var(--shadow);
  }
  .cmdp .top{ display:flex; gap:8px; align-items:center; padding:10px 12px; border-bottom:1px solid var(--border) }
  .cmdp input{ flex:1; border:none; outline:none; background:transparent; color:var(--fg); font-size:16px }
  .cmdp .list{ max-height: 50vh; overflow:auto }
  .cmdp .row{ padding:10px 12px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:8px; cursor:pointer }
  .cmdp .row:hover{ background: var(--glass) }
  .hidden{ display:none !important }

  /* Responsive */
  @media (max-width: 1100px){ .app{ grid-template-columns: 220px 1fr } }
  @media (max-width: 900px){ .right{ display:none } .app{ grid-template-columns: 220px 1fr } }

  @media print{
    header, .toolbar, .right, .star, .cmdp, #zenBtn { display:none !important }
    details.group{ border:none; box-shadow:none }
    body{ background:#fff; color:#000 }
  }
</style>
</head>
<body>
<header>
  <div class="container">
    <div class="row">
      <div class="logo">DD</div>
      <div class="grow">
        <h1>DevDocs Portal ‚Äî Song Ng·ªØ (EN‚ÄìVI)</h1>
        <div class="subtitle">VS Code-style ‚Ä¢ PWA offline ‚Ä¢ C·∫≠p nh·∫≠t: <span id="today"></span></div>
      </div>
      <div class="row">
        <select id="themeSelect" class="select" title="Ch·ªß ƒë·ªÅ">
          <option value="auto">Auto</option>
          <option value="light">Light</option>
          <option value="dark">Dark</option>
          <option value="vscode">VS Code</option>
          <option value="hacker">Hacker</option>
          <option value="solarized">Solarized</option>
          <option value="monokai">Monokai</option>
          <option value="dracula">Dracula</option>
          <option value="nord">Nord</option>
        </select>
        <div id="swatches" class="row" style="gap:6px">
          <button class="btn" data-theme="light" title="Light" style="padding:0;width:22px;height:22px;border-radius:6px;background:#fff;border-color:#d0d7de"></button>
          <button class="btn" data-theme="dark" title="Dark" style="padding:0;width:22px;height:22px;border-radius:6px;background:#0d1117;border-color:#30363d"></button>
          <button class="btn" data-theme="vscode" title="VS Code" style="padding:0;width:22px;height:22px;border-radius:6px;background:#0e1114;border-color:#2a2f36"></button>
          <button class="btn" data-theme="dracula" title="Dracula" style="padding:0;width:22px;height:22px;border-radius:6px;background:#282a36;border-color:#3b3e4c"></button>
          <button class="btn" data-theme="nord" title="Nord" style="padding:0;width:22px;height:22px;border-radius:6px;background:#2e3440;border-color:#3b4252"></button>
          <button class="btn" data-theme="hacker" title="Hacker" style="padding:0;width:22px;height:22px;border-radius:6px;background:#050;border-color:#113311"></button>
        </div>
        <button id="zenBtn" class="btn" title="Zen Mode (Alt+Z)">üßò Zen</button>
      </div>
    </div>

    <div class="toolbar" id="toolbar">
      <div class="search">
        <span>üîé</span>
        <input id="searchInput" type="search" list="suggestList" placeholder="T√¨m t√†i li·ªáu‚Ä¶ / Search docs‚Ä¶" />
        <datalist id="suggestList"></datalist>
      </div>
      <select id="groupFilter" class="select">
        <option value="">T·∫•t c·∫£ nh√≥m</option>
        <option>React</option><option>Tailwind</option><option>Python</option><option>C#</option><option>Java</option><option>Go</option><option>Web</option><option>Tools</option><option>Favorites</option>
      </select>
      <select id="typeFilter" class="select">
        <option value="">M·ªçi lo·∫°i</option>
        <option value="official">Official</option>
        <option value="vi">Ti·∫øng Vi·ªát</option>
        <option value="framework">Framework</option>
        <option value="library">Library</option>
        <option value="tool">Tool</option>
        <option value="spec">Spec</option>
        <option value="api">API</option>
        <option value="guide">Guide</option>
      </select>
      <button id="expandAll" class="btn">M·ªü t·∫•t c·∫£</button>
      <button id="collapseAll" class="btn">Thu g·ªçn</button>
      <button id="printBtn" class="btn">In / PDF</button>
      <button id="exportJson" class="btn">Export JSON</button>
      <button id="exportMd" class="btn">Export Markdown</button>
      <label class="btn"><input id="importJson" type="file" accept="application/json" class="hidden">Import JSON</label>
      <button id="exportNotes" class="btn">Export Notes</button>
      <label class="btn"><input id="importNotes" type="file" accept="application/json" class="hidden">Import Notes</label>
      <span class="chip">Ph√≠m t·∫Øt: <kbd>/</kbd> t√¨m ‚Ä¢ <kbd>‚åò/Ctrl</kbd>+<kbd>K</kbd> Command ‚Ä¢ <kbd>Shift</kbd>+<kbd>O</kbd> Preview ‚Ä¢ <kbd>Alt</kbd>+<kbd>Z</kbd> Zen</span>
    </div>
  </div>
</header>

<div class="app container">
  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar">
    <div class="s-title">Nh√≥m t√†i li·ªáu</div>
    <div id="sidebarGroups"></div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="panel stats">
      <div class="panel-body stats">
        <div class="stat" id="stat-total">T·ªïng link: 0</div>
        <div class="stat" id="stat-en">EN: 0</div>
        <div class="stat" id="stat-vi">VI: 0</div>
        <div class="stat" id="stat-fav">‚≠ê Favorites: 0</div>
      </div>
    </div>

    <div id="groups"></div>
  </main>

  <!-- RIGHT PANEL -->
  <aside class="right">
    <div class="panel">
      <h3>üìÑ Xem tr∆∞·ªõc t√†i li·ªáu (Preview)</h3>
      <div class="panel-body preview-wrap">
        <label><input type="checkbox" id="previewToggle"> M·ªü link trong khung xem tr∆∞·ªõc (iframe)</label>
        <div class="spinner" id="spinner"></div>
        <iframe id="previewFrame" class="hidden"></iframe>
      </div>
    </div>

    <div class="panel">
      <h3>üìù Ghi ch√∫ c√° nh√¢n</h3>
      <div class="panel-body">
        <div class="meta">Li√™n k·∫øt hi·ªán t·∫°i: <span id="noteLink" class="meta">‚Äî</span></div>
        <textarea id="noteArea" class="note-area" placeholder="Vi·∫øt ghi ch√∫ cho t√†i li·ªáu n√†y‚Ä¶"></textarea>
        <div class="row" style="margin-top:8px">
          <button id="saveNote" class="btn">L∆∞u ghi ch√∫</button>
          <button id="delNote" class="btn" style="color:var(--danger)">X√≥a ghi ch√∫</button>
        </div>
      </div>
    </div>
  </aside>
</div>

<!-- COMMAND PALETTE -->
<div class="cmdp" id="cmdp">
  <div class="box">
    <div class="top">
      <span>‚åòK</span>
      <input id="cmdpInput" placeholder="Nh·∫≠p ƒë·ªÉ t√¨m & m·ªü t√†i li·ªáu‚Ä¶" />
      <button id="cmdpClose" class="btn">ƒê√≥ng</button>
    </div>
    <div class="list" id="cmdpList"></div>
  </div>
</div>

<div class="tooltip" id="tooltip"></div>

<script>
(function(){
  const TODAY = new Date().toLocaleString();
  document.getElementById('today').textContent = TODAY;

  /* ===== KEYS ===== */
  const THEME_KEY="devdocs.theme", FAV_KEY="devdocs.favs", NOTES_KEY="devdocs.notes",
        DATA_KEY="devdocs.index", SCROLL_KEY="devdocs.scrollTop", OPEN_KEY="devdocs.openGroups",
        ZEN_KEY="devdocs.zen";

  /* ===== ELEMENTS ===== */
  const html = document.documentElement;
  const themeSelect = document.getElementById('themeSelect');
  const swatches = document.getElementById('swatches');
  const searchInput = document.getElementById('searchInput');
  const suggestList = document.getElementById('suggestList');
  const groupFilter = document.getElementById('groupFilter');
  const typeFilter = document.getElementById('typeFilter');
  const expandAllBtn = document.getElementById('expandAll');
  const collapseAllBtn = document.getElementById('collapseAll');
  const printBtn = document.getElementById('printBtn');
  const exportJsonBtn = document.getElementById('exportJson');
  const exportMdBtn = document.getElementById('exportMd');
  const importJsonInput = document.getElementById('importJson');
  const exportNotesBtn = document.getElementById('exportNotes');
  const importNotesInput = document.getElementById('importNotes');
  const groupsRoot = document.getElementById('groups');
  const sidebarGroups = document.getElementById('sidebarGroups');
  const statTotal = document.getElementById('stat-total');
  const statEN = document.getElementById('stat-en');
  const statVI = document.getElementById('stat-vi');
  const statFav = document.getElementById('stat-fav');

  const previewToggleEl = document.getElementById('previewToggle');
  const previewFrame = document.getElementById('previewFrame');
  const spinner = document.getElementById('spinner');
  const tooltip = document.getElementById('tooltip');
  const noteArea = document.getElementById('noteArea');
  const noteLink = document.getElementById('noteLink');
  const saveNoteBtn = document.getElementById('saveNote');
  const delNoteBtn = document.getElementById('delNote');
  const zenBtn = document.getElementById('zenBtn');

  const cmdp = document.getElementById('cmdp');
  const cmdpInput = document.getElementById('cmdpInput');
  const cmdpList = document.getElementById('cmdpList');
  const cmdpClose = document.getElementById('cmdpClose');

  /* ===== DATA ===== */
  const DATA = { groups: [
    { name: "React", icon: "‚öõÔ∏è", subtitle: "H·ªá sinh th√°i React", items: [
      {t:"React ‚Äì Official Docs", url:"https://react.dev", lang:"EN", type:"official", desc:"React official documentation.", tags:["react","official"]},
      {t:"React ‚Äì Legacy Docs", url:"https://legacy.reactjs.org", lang:"EN", type:"guide", desc:"Legacy docs for React 17 and below.", tags:["react","legacy"]},
      {t:"React ‚Äì Vietnamese Docs", url:"https://vi.reactjs.org/", lang:"VI", type:"guide", desc:"B·∫£n d·ªãch ti·∫øng Vi·ªát (n·∫øu c√≤n).", tags:["react","vi"]},
      {t:"Next.js ‚Äì Docs", url:"https://nextjs.org/docs", lang:"EN", type:"framework", desc:"React framework for production.", tags:["nextjs","framework"]},
      {t:"Redux Toolkit ‚Äì Docs", url:"https://redux-toolkit.js.org", lang:"EN", type:"library", desc:"Official Redux Toolkit.", tags:["redux","state"]},
      {t:"React Router ‚Äì Docs", url:"https://reactrouter.com/en/main", lang:"EN", type:"library", desc:"Routing for React apps.", tags:["router","spa"]},
      {t:"TanStack Query ‚Äì Docs", url:"https://tanstack.com/query/latest/docs/react", lang:"EN", type:"library", desc:"Data fetching & caching.", tags:["query","data"]},
      {t:"TypeScript ‚Äì Docs", url:"https://www.typescriptlang.org/docs/", lang:"EN", type:"guide", desc:"Typed superset of JS.", tags:["typescript","ts"]},
      {t:"Vite ‚Äì Guide", url:"https://vitejs.dev/guide/", lang:"EN", type:"tool", desc:"Frontend tooling & dev server.", tags:["vite","build"]},
      {t:"Babel ‚Äì Docs", url:"https://babeljs.io/docs/", lang:"EN", type:"tool", desc:"JS compiler.", tags:["babel","compiler"]},
    ]},
    { name: "Tailwind", icon: "üé®", subtitle: "Th∆∞ vi·ªán giao di·ªán", items: [
      {t:"Tailwind CSS ‚Äì Docs", url:"https://tailwindcss.com/docs", lang:"EN", type:"official", desc:"Utility-first CSS framework.", tags:["tailwind","css"]},
      {t:"Tailwind CSS ‚Äì Ti·∫øng Vi·ªát", url:"https://v1.tailwindcss.vn/docs", lang:"VI", type:"guide", desc:"B·∫£n d·ªãch community.", tags:["tailwind","vi"]},
      {t:"shadcn/ui ‚Äì Docs", url:"https://ui.shadcn.com", lang:"EN", type:"library", desc:"Headless + Tailwind component.", tags:["shadcn","ui"]},
      {t:"daisyUI ‚Äì Components", url:"https://daisyui.com/components/", lang:"EN", type:"library", desc:"Tailwind components.", tags:["daisyui","ui"]},
      {t:"Flowbite ‚Äì Docs", url:"https://flowbite.com/docs/", lang:"EN", type:"library", desc:"Tailwind components kit.", tags:["flowbite","ui"]},
      {t:"Headless UI ‚Äì Docs", url:"https://headlessui.com", lang:"EN", type:"library", desc:"Unstyled UI primitives.", tags:["headlessui","ui"]},
    ]},
    { name: "Python", icon: "üêç", subtitle: "Ng√¥n ng·ªØ & ML", items: [
      {t:"Python ‚Äì Official Docs", url:"https://docs.python.org/3/", lang:"EN", type:"official", desc:"Python language and stdlib.", tags:["python","official"]},
      {t:"Python ‚Äì Ti·∫øng Vi·ªát", url:"https://docs.python.org/vi/3/", lang:"VI", type:"guide", desc:"B·∫£n d·ªãch ti·∫øng Vi·ªát.", tags:["python","vi"]},
      {t:"PyPI ‚Äì Packages", url:"https://pypi.org/", lang:"EN", type:"api", desc:"Python Package Index.", tags:["pypi","packages"]},
      {t:"NumPy ‚Äì Docs", url:"https://numpy.org/doc/", lang:"EN", type:"library", desc:"Numerical computing.", tags:["numpy","math"]},
      {t:"Pandas ‚Äì Docs", url:"https://pandas.pydata.org/docs/", lang:"EN", type:"library", desc:"Data analysis.", tags:["pandas","data"]},
      {t:"scikit-learn ‚Äì Docs", url:"https://scikit-learn.org/stable/", lang:"EN", type:"library", desc:"Machine learning.", tags:["sklearn","ml"]},
      {t:"Matplotlib ‚Äì Docs", url:"https://matplotlib.org/stable/contents.html", lang:"EN", type:"library", desc:"Plotting.", tags:["matplotlib","plot"]},
      {t:"Flask ‚Äì Docs", url:"https://flask.palletsprojects.com/en/stable/", lang:"EN", type:"framework", desc:"Micro web framework.", tags:["flask","web"]},
      {t:"Django ‚Äì Docs", url:"https://docs.djangoproject.com/en/stable/", lang:"EN", type:"framework", desc:"Full-stack web framework.", tags:["django","web"]},
      {t:"FastAPI ‚Äì Docs", url:"https://fastapi.tiangolo.com/", lang:"EN", type:"framework", desc:"High-performance APIs.", tags:["fastapi","api"]},
      {t:"Hitchhiker‚Äôs Guide to Python", url:"https://docs.python-guide.org/", lang:"EN", type:"guide", desc:"Best practices.", tags:["guide","best-practice"]},
    ]},
    { name: "C#", icon: "üß±", subtitle: "N·ªÅn t·∫£ng .NET", items: [
      {t:"C# ‚Äì Microsoft Learn", url:"https://learn.microsoft.com/en-us/dotnet/csharp/", lang:"EN", type:"official", desc:"Language guide.", tags:["csharp","official"]},
      {t:".NET ‚Äì API Reference", url:"https://learn.microsoft.com/en-us/dotnet/api/", lang:"EN", type:"api", desc:".NET API surfaces.", tags:["dotnet","api"]},
      {t:"ASP.NET Core ‚Äì Docs", url:"https://learn.microsoft.com/en-us/aspnet/core", lang:"EN", type:"framework", desc:"Web with .NET.", tags:["aspnet","web"]},
      {t:"Entity Framework Core ‚Äì Docs", url:"https://learn.microsoft.com/en-us/ef/core/", lang:"EN", type:"library", desc:"ORM for .NET.", tags:["efcore","orm"]},
      {t:"WinForms ‚Äì Docs", url:"https://learn.microsoft.com/en-us/dotnet/desktop/winforms/", lang:"EN", type:"framework", desc:"Windows Forms.", tags:["winforms","desktop"]},
      {t:"Blazor ‚Äì Docs", url:"https://learn.microsoft.com/en-us/aspnet/core/blazor/", lang:"EN", type:"framework", desc:"Web UI with .NET.", tags:["blazor","web"]},
      {t:"LINQ ‚Äì Docs", url:"https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/", lang:"EN", type:"guide", desc:"Language Integrated Query.", tags:["linq","query"]},
      {t:"NuGet ‚Äì Packages", url:"https://www.nuget.org/", lang:"EN", type:"api", desc:".NET packages.", tags:["nuget","packages"]},
    ]},
    { name: "Java", icon: "‚òï", subtitle: "H·ªá sinh th√°i Java", items: [
      {t:"Java SE ‚Äì Docs", url:"https://docs.oracle.com/en/java/javase/", lang:"EN", type:"official", desc:"Java SE documentation.", tags:["java","official"]},
      {t:"The Java Tutorials", url:"https://docs.oracle.com/javase/tutorial/", lang:"EN", type:"guide", desc:"Official tutorials.", tags:["java","tutorial"]},
      {t:"Spring Framework ‚Äì Reference", url:"https://docs.spring.io/spring-framework/reference/", lang:"EN", type:"framework", desc:"Spring core.", tags:["spring","framework"]},
      {t:"Spring Boot ‚Äì Reference", url:"https://docs.spring.io/spring-boot/docs/current/reference/html/", lang:"EN", type:"framework", desc:"Spring Boot.", tags:["spring-boot","framework"]},
      {t:"Hibernate ORM ‚Äì Docs", url:"https://hibernate.org/orm/documentation/", lang:"EN", type:"library", desc:"Popular Java ORM.", tags:["hibernate","orm"]},
      {t:"Maven ‚Äì Guides", url:"https://maven.apache.org/guides/", lang:"EN", type:"tool", desc:"Build automation.", tags:["maven","build"]},
      {t:"Gradle ‚Äì User Guide", url:"https://docs.gradle.org/current/userguide/userguide.html", lang:"EN", type:"tool", desc:"Build tool.", tags:["gradle","build"]},
      {t:"JavaFX ‚Äì Javadoc", url:"https://openjfx.io/javadoc/", lang:"EN", type:"api", desc:"JavaFX API.", tags:["javafx","ui"]},
    ]},
    { name: "Go", icon: "üêπ", subtitle: "Ng√¥n ng·ªØ & th∆∞ vi·ªán", items: [
      {t:"Go ‚Äì Official Docs", url:"https://go.dev/doc/", lang:"EN", type:"official", desc:"Go language docs.", tags:["go","official"]},
      {t:"Go ‚Äì Standard Library API", url:"https://pkg.go.dev/std", lang:"EN", type:"api", desc:"Std library.", tags:["stdlib"]},
      {t:"Effective Go", url:"https://go.dev/doc/effective_go", lang:"EN", type:"guide", desc:"Idiomatic Go.", tags:["style","best-practice"]},
      {t:"Gin ‚Äì Docs", url:"https://gin-gonic.com/docs/", lang:"EN", type:"framework", desc:"Go web framework.", tags:["gin","web"]},
      {t:"GORM ‚Äì Docs", url:"https://gorm.io/docs/", lang:"EN", type:"library", desc:"ORM for Go.", tags:["gorm","orm"]},
      {t:"Cobra ‚Äì CLI Framework", url:"https://cobra.dev/", lang:"EN", type:"library", desc:"CLI toolkit.", tags:["cobra","cli"]},
      {t:"Viper ‚Äì Config", url:"https://pkg.go.dev/github.com/spf13/viper", lang:"EN", type:"library", desc:"Config for Go.", tags:["viper","config"]},
      {t:"Go by Example", url:"https://gobyexample.com/", lang:"EN", type:"guide", desc:"Annotated examples.", tags:["examples"]},
    ]},
    { name: "Web", icon: "üåê", subtitle: "Chu·∫©n & T√†i li·ªáu", items: [
      {t:"MDN ‚Äì HTML (EN)", url:"https://developer.mozilla.org/en-US/docs/Web/HTML", lang:"EN", type:"guide", desc:"HTML reference and guides.", tags:["mdn","html"]},
      {t:"MDN ‚Äì HTML (VI)", url:"https://developer.mozilla.org/vi/docs/Web/HTML", lang:"VI", type:"guide", desc:"T√†i li·ªáu HTML ti·∫øng Vi·ªát.", tags:["mdn","html","vi"]},
      {t:"MDN ‚Äì CSS (EN)", url:"https://developer.mozilla.org/en-US/docs/Web/CSS", lang:"EN", type:"guide", desc:"CSS reference and guides.", tags:["mdn","css"]},
      {t:"MDN ‚Äì CSS (VI)", url:"https://developer.mozilla.org/vi/docs/Web/CSS", lang:"VI", type:"guide", desc:"T√†i li·ªáu CSS ti·∫øng Vi·ªát.", tags:["mdn","css","vi"]},
      {t:"MDN ‚Äì JavaScript (EN)", url:"https://developer.mozilla.org/en-US/docs/Web/JavaScript", lang:"EN", type:"guide", desc:"JavaScript docs.", tags:["mdn","js"]},
      {t:"MDN ‚Äì JavaScript (VI)", url:"https://developer.mozilla.org/vi/docs/Web/JavaScript", lang:"VI", type:"guide", desc:"T√†i li·ªáu JS ti·∫øng Vi·ªát.", tags:["mdn","js","vi"]},
      {t:"WHATWG ‚Äì HTML Living Standard", url:"https://html.spec.whatwg.org/", lang:"EN", type:"spec", desc:"HTML living standard.", tags:["whatwg","html","spec"]},
      {t:"W3C ‚Äì CSS Specifications", url:"https://www.w3.org/Style/CSS/specs.en.html", lang:"EN", type:"spec", desc:"CSS specs.", tags:["w3c","css","spec"]},
      {t:"Can I Use ‚Äì Browser Support", url:"https://caniuse.com/", lang:"EN", type:"tool", desc:"Browser compatibility.", tags:["compat","browser"]},
      {t:"WHATWG ‚Äì Fetch Standard", url:"https://fetch.spec.whatwg.org/", lang:"EN", type:"spec", desc:"Fetch standard.", tags:["fetch","spec"]},
      {t:"ECMAScript (TC39) ‚Äì Spec", url:"https://tc39.es/ecma262/", lang:"EN", type:"spec", desc:"JS language specification.", tags:["ecmascript","spec"]},
    ]},
    { name: "Tools", icon: "üß©", subtitle: "C√¥ng c·ª• ph√°t tri·ªÉn", items: [
      {t:"Git ‚Äì Documentation", url:"https://git-scm.com/docs", lang:"EN", type:"guide", desc:"Git manual and guides.", tags:["git","vcs"]},
      {t:"GitHub ‚Äì Docs", url:"https://docs.github.com/en", lang:"EN", type:"guide", desc:"GitHub documentation.", tags:["github"]},
      {t:"Node.js ‚Äì Docs", url:"https://nodejs.org/en/docs", lang:"EN", type:"guide", desc:"Node.js documentation.", tags:["node","js"]},
      {t:"pnpm ‚Äì Docs", url:"https://pnpm.io/motivation", lang:"EN", type:"guide", desc:"Fast package manager.", tags:["pnpm","packages"]},
      {t:"Yarn ‚Äì Docs", url:"https://yarnpkg.com/getting-started", lang:"EN", type:"guide", desc:"Yarn package manager.", tags:["yarn","packages"]},
      {t:"ESLint ‚Äì Docs", url:"https://eslint.org/docs/latest/", lang:"EN", type:"guide", desc:"Linting for JS/TS.", tags:["eslint","lint"]},
      {t:"Prettier ‚Äì Docs", url:"https://prettier.io/docs/en/", lang:"EN", type:"guide", desc:"Code formatter.", tags:["prettier","format"]},
      {t:"Webpack ‚Äì Concepts", url:"https://webpack.js.org/concepts/", lang:"EN", type:"guide", desc:"Module bundler concepts.", tags:["webpack","bundler"]},
      {t:"Rollup ‚Äì Docs", url:"https://rollupjs.org/introduction/", lang:"EN", type:"guide", desc:"Bundler and build.", tags:["rollup","bundler"]},
      {t:"Vite ‚Äì Guide", url:"https://vitejs.dev/guide/", lang:"EN", type:"guide", desc:"Next-gen frontend tooling.", tags:["vite","build"]},
    ]},
  ]};

  /* ===== STATE ===== */
  const state = {
    theme: localStorage.getItem(THEME_KEY) || 'auto',
    favorites: JSON.parse(localStorage.getItem(FAV_KEY) || "[]"),
    notes: JSON.parse(localStorage.getItem(NOTES_KEY) || "{}"),
    data: JSON.parse(localStorage.getItem(DATA_KEY) || "null") || DATA,
    openInPreview: false,
    currentLink: null,
  };

  /* ===== THEME ===== */
  function applyTheme(){ html.setAttribute('data-theme', state.theme); themeSelect.value = state.theme; localStorage.setItem(THEME_KEY, state.theme); }
  applyTheme();
  themeSelect.addEventListener('change', ()=>{ state.theme = themeSelect.value; applyTheme(); });
  swatches.addEventListener('click', (e)=>{ const t=e.target.closest('button'); if(!t) return; state.theme=t.dataset.theme; applyTheme(); });

  /* ===== BUILD SIDEBAR ===== */
  function buildSidebar(){
    sidebarGroups.innerHTML = "";
    state.data.groups.forEach((g, idx)=>{
      const b = document.createElement('button');
      b.className="group-btn"; b.innerHTML = `<span>${g.icon||"üì¶"}</span><span>${g.name}</span>`;
      b.addEventListener('click', ()=>{
        // scroll to group in main
        const el = document.querySelector(`[data-group-index="${idx}"]`);
        if (el){ el.scrollIntoView({behavior:'smooth', block:'start'}); highlight(el); }
      });
      sidebarGroups.appendChild(b);
    });
  }
  function highlight(el){ el.style.boxShadow="0 0 0 3px var(--accent) inset"; setTimeout(()=> el.style.boxShadow="", 500); }

  /* ===== BUILD GROUPS (MAIN) ===== */
  function buildGroups(){
    groupsRoot.innerHTML=""; const frag=document.createDocumentFragment();
    state.data.groups.forEach((group, gi)=>{
      const det = document.createElement('details');
      det.className="group"; det.open=true; det.dataset.groupIndex=gi;

      const sum = document.createElement('summary');
      sum.innerHTML = `<div style="display:flex;align-items:center;gap:10px">
        <span>${group.icon||"üì¶"}</span><strong>${group.name}</strong>
        <span class="meta">‚Äî ${group.subtitle||""}</span></div>
        <span class="chip">${group.items.filter(i=>i.lang==="VI").length>0?"EN+VI":"EN"}</span>`;
      det.appendChild(sum);

      // accordion body (animated)
      const acc = document.createElement('div'); acc.className="accordion";
      const links = document.createElement('div'); links.className="links";

      group.items.forEach(item=>{
        const row = document.createElement('div'); row.className="item";
        row.dataset.group = group.name;
        row.dataset.type = item.type;
        row.dataset.lang = item.lang;
        row.dataset.url = item.url;
        row.dataset.title = item.t;
        row.dataset.tags = (item.tags || []).join(",");

        const favActive = state.favorites.includes(item.url);
        const star = document.createElement('span'); star.className="star"; star.textContent = favActive ? "‚òÖ" : "‚òÜ";
        if (favActive) star.classList.add('active');
        star.title="Th√™m/B·ªè y√™u th√≠ch";
        star.addEventListener('click', (e)=>{ e.stopPropagation(); toggleFavorite(item.url, star); });

        const favico = document.createElement('img'); favico.className="favico";
        try{
          const u = new URL(item.url);
          favico.src = `https://www.google.com/s2/favicons?sz=32&domain=${u.hostname}`;
        }catch{ favico.src=""; }

        const a = document.createElement('a'); a.href=item.url; a.target="_blank";
        a.textContent = item.t + (item.lang ? ` (${item.lang})` : "");
        a.title = item.desc || "";
        a.addEventListener('click', (e)=>{
          if (state.openInPreview || e.shiftKey){ e.preventDefault(); openInPreview(item.url); setCurrentNoteLink(item.url, item.t); }
          else { setCurrentNoteLink(item.url, item.t); }
        });
        a.addEventListener('mouseenter', (e)=> showTooltip(e, item));
        a.addEventListener('mouseleave', hideTooltip);

        const meta = document.createElement('span'); meta.className='meta'; meta.textContent = `‚Ä¢ ${item.type}`;

        row.appendChild(star); row.appendChild(favico); row.appendChild(a); row.appendChild(meta);
        links.appendChild(row);
      });

      acc.appendChild(links); det.appendChild(acc);
      // close others on open, save open state
      det.addEventListener('toggle', ()=>{ saveOpenGroups(); });

      frag.appendChild(det);
    });
    groupsRoot.appendChild(frag);
    updateStats(); buildSuggestions(); restoreOpenGroups();
  }

  /* ===== STATS ===== */
  function updateStats(){
    const all = Array.from(groupsRoot.querySelectorAll('.item'));
    statTotal.textContent = `T·ªïng link: ${all.length}`;
    statEN.textContent = `EN: ${all.filter(x=>x.dataset.lang==="EN").length}`;
    statVI.textContent = `VI: ${all.filter(x=>x.dataset.lang==="VI").length}`;
    statFav.textContent = `‚≠ê Favorites: ${state.favorites.length}`;
  }

  /* ===== FAVORITES ===== */
  function toggleFavorite(url, el){
    const i = state.favorites.indexOf(url);
    if (i===-1) state.favorites.push(url); else state.favorites.splice(i,1);
    localStorage.setItem(FAV_KEY, JSON.stringify(state.favorites));
    el.textContent = state.favorites.includes(url) ? "‚òÖ" : "‚òÜ";
    el.classList.toggle('active', state.favorites.includes(url));
    updateStats(); applyFilters();
  }

  /* ===== TOOLTIP ===== */
  function showTooltip(e, item){
    tooltip.textContent = item.desc || ''; if(!tooltip.textContent) return;
    tooltip.style.display='block'; const pad=10; tooltip.style.left=(e.pageX+pad)+'px'; tooltip.style.top=(e.pageY+pad)+'px';
  }
  function hideTooltip(){ tooltip.style.display='none'; }

  /* ===== PREVIEW ===== */
  function openInPreview(url){ previewFrame.classList.remove('hidden'); spinner.style.display='flex'; previewFrame.src=url; }
  previewFrame.addEventListener('load', ()=> spinner.style.display='none');
  previewToggleEl.addEventListener('change', ()=>{ state.openInPreview = previewToggleEl.checked; if(!state.openInPreview) previewFrame.classList.add('hidden'); });
  document.addEventListener('keydown',(e)=>{ if (e.shiftKey && (e.key === 'O' || e.key === 'o')){ previewToggleEl.checked = !previewToggleEl.checked; previewToggleEl.dispatchEvent(new Event('change')); } });

  /* ===== NOTES ===== */
  function setCurrentNoteLink(url, title){ state.currentLink=url; noteLink.textContent = title || url || "‚Äî"; noteArea.value = (state.notes[url] || ""); }
  saveNoteBtn.addEventListener('click', ()=>{ if(!state.currentLink) return alert("H√£y m·ªü m·ªôt li√™n k·∫øt tr∆∞·ªõc ƒë√£."); state.notes[state.currentLink]=noteArea.value||""; localStorage.setItem(NOTES_KEY, JSON.stringify(state.notes)); alert("ƒê√£ l∆∞u ghi ch√∫.");});
  delNoteBtn.addEventListener('click', ()=>{ if(!state.currentLink) return; delete state.notes[state.currentLink]; localStorage.setItem(NOTES_KEY, JSON.stringify(state.notes)); noteArea.value=""; alert("ƒê√£ x√≥a ghi ch√∫."); });

  /* ===== SEARCH + FILTER ===== */
  function normalize(s){ return (s||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,''); }
  function applyFilters(){
    const q = normalize(searchInput.value), g = groupFilter.value, tp = typeFilter.value;
    const items = Array.from(groupsRoot.querySelectorAll('.item'));
    items.forEach(it=>{
      const text = normalize(it.dataset.title + " " + it.dataset.tags + " " + it.dataset.url + " " + it.dataset.group + " " + it.dataset.type + " " + it.dataset.lang);
      let hit = (!q || text.includes(q));
      if (g){ if (g==="Favorites") hit = hit && state.favorites.includes(it.dataset.url); else hit = hit && it.dataset.group===g; }
      if (tp) hit = hit && it.dataset.type===tp;
      it.style.display = hit ? "flex" : "none";
    });
    // auto open groups with visible items
    Array.from(groupsRoot.querySelectorAll('details.group')).forEach(d=>{
      const body = d.querySelector('.accordion');
      const any = Array.from(d.querySelectorAll('.item')).some(x => x.style.display !== 'none');
      d.open = any; d.classList.toggle('hidden', !any);
      body.style.maxHeight = d.open ? '800px' : '0px';
      body.style.opacity  = d.open ? '1' : '0';
    });
  }
  searchInput.addEventListener('input', applyFilters);
  groupFilter.addEventListener('change', applyFilters);
  typeFilter.addEventListener('change', applyFilters);
  document.addEventListener('keydown', (e)=>{ if (e.key === '/'){ e.preventDefault(); searchInput.focus(); } });

  /* ===== EXPAND/COLLAPSE ===== */
  expandAllBtn.addEventListener('click', ()=>{ document.querySelectorAll('details.group').forEach(d=>{ d.open=true; const b=d.querySelector('.accordion'); if(b){b.style.maxHeight='800px'; b.style.opacity='1';} }); saveOpenGroups(); });
  collapseAllBtn.addEventListener('click', ()=>{ document.querySelectorAll('details.group').forEach(d=>{ d.open=false; const b=d.querySelector('.accordion'); if(b){b.style.maxHeight='0px'; b.style.opacity='0';} }); saveOpenGroups(); });

  /* ===== EXPORT/IMPORT ===== */
  printBtn.addEventListener('click', ()=> window.print());
  function download(filename, text, type="text/plain"){ const a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([text],{type})); a.download=filename; a.click(); URL.revokeObjectURL(a.href); }
  exportJsonBtn.addEventListener('click', ()=> download('devdocs-index.json', JSON.stringify(state.data,null,2), 'application/json'));
  exportMdBtn.addEventListener('click', ()=>{
    let md = `# DevDocs Portal (EN‚ÄìVI)\nC·∫≠p nh·∫≠t: ${TODAY}\n\n`;
    state.data.groups.forEach(g=>{ md += `## ${g.name} ‚Äî ${g.subtitle||""}\n\n`; g.items.forEach(i=>{ md += `- [${i.t}](${i.url}) ‚Äî ${i.type}${i.lang? ' ¬∑ ' + i.lang : ''}\n`; }); md+=`\n`; });
    download('devdocs-links.md', md, 'text/markdown');
  });
  importJsonInput.addEventListener('change', async (e)=>{
    const f=e.target.files[0]; if(!f) return; try{ const incoming=JSON.parse(await f.text()); mergeData(incoming); localStorage.setItem(DATA_KEY, JSON.stringify(state.data)); buildGroups(); applyFilters(); alert("ƒê√£ nh·∫≠p & h·ª£p nh·∫•t JSON t√†i li·ªáu.");}catch{ alert("File JSON kh√¥ng h·ª£p l·ªá."); } e.target.value="";
  });
  exportNotesBtn.addEventListener('click', ()=> download('devdocs-notes.json', JSON.stringify(state.notes,null,2), 'application/json'));
  importNotesInput.addEventListener('change', async (e)=>{
    const f=e.target.files[0]; if(!f) return; try{ Object.assign(state.notes, JSON.parse(await f.text())); localStorage.setItem(NOTES_KEY, JSON.stringify(state.notes)); alert("ƒê√£ import notes."); }catch{ alert("Notes JSON kh√¥ng h·ª£p l·ªá."); } e.target.value="";
  });
  function mergeData(incoming){
    const mapGroup = new Map(state.data.groups.map(g=>[g.name,g]));
    (incoming.groups||[]).forEach(g=>{
      if(!mapGroup.has(g.name)) state.data.groups.push(g);
      else{
        const tgt=mapGroup.get(g.name), urls=new Set(tgt.items.map(i=>i.url));
        (g.items||[]).forEach(i=>{ if(!urls.has(i.url)){ tgt.items.push(i); urls.add(i.url); } });
      }
    });
  }

  /* ===== OPEN GROUPS + SCROLL PERSIST ===== */
  function saveOpenGroups(){
    const open=[]; document.querySelectorAll('details.group').forEach((d,i)=>{ if(d.open) open.push(i); });
    localStorage.setItem(OPEN_KEY, JSON.stringify(open));
  }
  function restoreOpenGroups(){
    try{
      const open=JSON.parse(localStorage.getItem(OPEN_KEY)||"[]");
      document.querySelectorAll('details.group').forEach((d,i)=>{ d.open = open.includes(i); const b=d.querySelector('.accordion'); if(b){ b.style.maxHeight = d.open ? '800px':'0px'; b.style.opacity = d.open ? '1':'0'; } });
    }catch{}
  }
  window.addEventListener('beforeunload', ()=> localStorage.setItem(SCROLL_KEY, String(window.scrollY)));
  window.addEventListener('load', ()=>{ const y=parseInt(localStorage.getItem(SCROLL_KEY)||"0",10); if(!isNaN(y)) window.scrollTo(0,y); });

  /* ===== ZEN MODE (toggle + hotkey + persistent) ===== */
  function applyZen(){ const zen = localStorage.getItem(ZEN_KEY)==='1'; document.body.classList.toggle('zen', zen); zenBtn.textContent = zen ? "‚úñÔ∏è Exit Zen" : "üßò Zen"; }
  applyZen();
  zenBtn.addEventListener('click', ()=>{ const zen = !(localStorage.getItem(ZEN_KEY)==='1'); localStorage.setItem(ZEN_KEY, zen?'1':'0'); applyZen(); });
  document.addEventListener('keydown', (e)=>{ if(e.altKey && (e.key==='z' || e.key==='Z')){ const zen = !(localStorage.getItem(ZEN_KEY)==='1'); localStorage.setItem(ZEN_KEY, zen?'1':'0'); applyZen(); } });

  /* ===== COMMAND PALETTE (‚åò/Ctrl + K) ===== */
  function openCmd(){ cmdp.style.display='flex'; cmdpInput.value=''; buildCmdList(''); cmdpInput.focus(); }
  function closeCmd(){ cmdp.style.display='none'; }
  function buildCmdList(q){
    cmdpList.innerHTML="";
    const items = [];
    state.data.groups.forEach(g=> g.items.forEach(i=> items.push({g:g.name, ...i})));
    const norm = (s)=> (s||'').toLowerCase();
    const filtered = q ? items.filter(x=>`${x.g} ${x.t} ${x.tags}`.toLowerCase().includes(q.toLowerCase())) : items.slice(0,200);
    filtered.slice(0,400).forEach(it=>{
      const row=document.createElement('div'); row.className='row';
      const favico=document.createElement('img'); favico.className='favico';
      try{ const u=new URL(it.url); favico.src=`https://www.google.com/s2/favicons?sz=32&domain=${u.hostname}`; }catch{}
      const title=document.createElement('div'); title.innerHTML=`<strong>${it.t}</strong> <span class="meta">¬∑ ${it.g} ¬∑ ${it.type}${it.lang?' ¬∑ '+it.lang:''}</span>`;
      row.appendChild(favico); row.appendChild(title);
      row.addEventListener('click', ()=>{ if(state.openInPreview){ openInPreview(it.url); setCurrentNoteLink(it.url, it.t);} else { window.open(it.url,'_blank'); setCurrentNoteLink(it.url, it.t);} closeCmd(); });
      cmdpList.appendChild(row);
    });
  }
  cmdpInput.addEventListener('input', ()=> buildCmdList(cmdpInput.value));
  cmdpClose.addEventListener('click', closeCmd);
  document.addEventListener('keydown', (e)=>{
    const isMac = navigator.platform.toUpperCase().indexOf('MAC')>=0;
    if ((isMac && e.metaKey && e.key==='k') || (!isMac && e.ctrlKey && e.key==='k')){
      e.preventDefault(); openCmd();
    }
  });
  cmdp.addEventListener('click', (e)=>{ if(e.target===cmdp) closeCmd(); });

  /* ===== SUGGESTIONS (datalist) ===== */
  function buildSuggestions(){
    suggestList.innerHTML=""; const set=new Set();
    state.data.groups.forEach(g => g.items.forEach(i => { set.add(`${g.name}: ${i.t}`); (i.tags||[]).forEach(t=>set.add(`${g.name} ¬∑ ${t}`)); set.add(g.name); }));
    [...set].sort().forEach(x=>{ const opt=document.createElement('option'); opt.value=x; suggestList.appendChild(opt); });
  }

  /* ===== INIT ===== */
  buildSidebar(); buildGroups(); buildSuggestions(); applyFilters();

  /* ====== PWA SERVICE WORKER (inline) ====== */
  if ('serviceWorker' in navigator){
    // Inline service worker via Blob so v·∫´n l√† 1 file HTML t·ª± ƒë·ªß
    const swCode = `
      const CACHE = 'devdocs-v3';
      const ASSETS = ['.']; // cache trang hi·ªán t·∫°i
      self.addEventListener('install', e=>{
        e.waitUntil(caches.open(CACHE).then(c=>c.addAll(ASSETS)));
        self.skipWaiting();
      });
      self.addEventListener('activate', e=>{
        e.waitUntil(caches.keys().then(keys=>Promise.all(keys.map(k=>k===CACHE?null:caches.delete(k)))));
        self.clients.claim();
      });
      self.addEventListener('fetch', e=>{
        const url = new URL(e.request.url);
        // Network-first cho docs online; cache-first cho ch√≠nh app
        if (url.origin === location.origin){
          e.respondWith(caches.match(e.request).then(r=> r || fetch(e.request).then(resp=>{
            const clone = resp.clone(); caches.open(CACHE).then(c=>c.put(e.request, clone)); return resp;
          }).catch(()=> caches.match('.'))));
        } else {
          // pass-through cho t√†i nguy√™n ngo√†i (docs, favicon)
          e.respondWith(fetch(e.request).catch(()=> new Response('Offline', {status:503,statusText:'Offline'})));
        }
      });
    `;
    const blob = new Blob([swCode], {type:'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl);
  }

  /* ====== EPUB EXPORT (minimal ZIP store) ======
     T·∫°o EPUB ƒë∆°n gi·∫£n: 1 chapter ch·ª©a to√†n b·ªô link theo nh√≥m.
     ZIP "store" (no compression) ‚Äî ƒë·ªß ƒë·ªÉ nhi·ªÅu reader m·ªü.
  */
  function crc32(buf){ // CRC-32 tiny impl
    let c=~0>>>0; for(let i=0;i<buf.length;i++){ c=c^(buf[i]); for(let k=0;k<8;k++){ c = (c>>>1) ^ (0xEDB88320 & (-(c&1))); } } return (~c)>>>0;
  }
  function str2u8(s){ return new TextEncoder().encode(s); }
  function num32le(n){ const b=new Uint8Array(4); const dv=new DataView(b.buffer); dv.setUint32(0,n,true); return b; }
  function num16le(n){ const b=new Uint8Array(2); const dv=new DataView(b.buffer); dv.setUint16(0,n,true); return b; }
  function zipStore(files){ // files: [{name, data(Uint8Array), uncompressed:true}]
    const fileRecords=[]; const chunks=[];
    let offset=0;
    for(const f of files){
      const data = f.data;
      const crc = crc32(data);
      const nameU8 = str2u8(f.name);
      // Local file header
      const LFH = [
        num32le(0x04034b50), num16le(20), num16le(0), num16le(0), num16le(0), num16le(0),
        num32le(crc), num32le(data.length), num32le(data.length), num16le(nameU8.length), num16le(0)
      ];
      const head = concatU8(...LFH, nameU8);
      chunks.push(head, data);
      const headerOffset = offset; offset += head.length + data.length;
      fileRecords.push({nameU8, crc, size:data.length, offset:headerOffset});
    }
    // Central Directory
    const cdChunks=[]; let cdSize=0;
    for(const fr of fileRecords){
      const CDFH = [
        num32le(0x02014b50), num16le(20), num16le(20), num16le(0), num16le(0), num16le(0), num16le(0),
        num32le(fr.crc), num32le(fr.size), num32le(fr.size), num16le(fr.nameU8.length), num16le(0), num16le(0),
        num16le(0), num16le(0), num32le(0), num32le(fr.offset)
      ];
      const rec = concatU8(...CDFH, fr.nameU8);
      cdChunks.push(rec); cdSize += rec.length;
    }
    const cdStart = offset;
    const cd = concatU8(...cdChunks); chunks.push(cd); offset += cd.length;
    const EOCD = concatU8(
      num32le(0x06054b50), num16le(0), num16le(0), num16le(fileRecords.length), num16le(fileRecords.length),
      num32le(cdSize), num32le(cdStart), num16le(0)
    );
    chunks.push(EOCD);
    return new Blob([concatU8(...chunks)], {type:'application/epub+zip'});
  }
  function concatU8(...arrs){ let total=0; arrs.forEach(a=> total+=a.length); const out=new Uint8Array(total); let off=0; arrs.forEach(a=>{ out.set(a,off); off+=a.length; }); return out; }

  // Export EPUB button (add to toolbar automatically)
  const epubBtn = document.createElement('button'); epubBtn.className='btn'; epubBtn.textContent='Export EPUB';
  document.getElementById('toolbar').appendChild(epubBtn);
  epubBtn.addEventListener('click', ()=>{
    // Build simple EPUB content
    const title = 'DevDocs Portal Links';
    const listHTML = state.data.groups.map(g=>{
      const items = g.items.map(i=>`<li><a href="${i.url}">${escapeHtml(i.t)}</a> ‚Äî ${i.type}${i.lang? ' ¬∑ '+i.lang:''}</li>`).join('');
      return `<h2>${escapeHtml(g.name)} ‚Äî <small>${escapeHtml(g.subtitle||'')}</small></h2><ul>${items}</ul>`;
    }).join('\n');

    const containerXml = `<?xml version="1.0" encoding="UTF-8"?>\n<container version="1.0" xmlns="urn:oasis:names:tc:opendocument:xmlns:container">\n  <rootfiles>\n    <rootfile full-path="OEBPS/content.opf" media-type="application/oebps-package+xml"/>\n  </rootfiles>\n</container>`;
    const navXhtml = `<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="utf-8"/><title>Nav</title></head><body><nav epub:type="toc"><ol><li><a href="chapter.xhtml">DevDocs</a></li></ol></nav></body></html>`;
    const chapter = `<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta charset="utf-8"/><title>${escapeHtml(title)}</title></head><body><h1>${escapeHtml(title)}</h1>${listHTML}</body></html>`;
    const opf = `<?xml version="1.0" encoding="utf-8"?>\n<package xmlns="http://www.idpf.org/2007/opf" unique-identifier="BookId" version="3.0">\n  <metadata xmlns:dc="http://purl.org/dc/elements/1.1/">\n    <dc:identifier id="BookId">devdocs-portal-v3</dc:identifier>\n    <dc:title>${escapeXml(title)}</dc:title>\n    <dc:language>en</dc:language>\n  </metadata>\n  <manifest>\n    <item id="nav" href="nav.xhtml" media-type="application/xhtml+xml" properties="nav"/>\n    <item id="chap" href="chapter.xhtml" media-type="application/xhtml+xml"/>\n  </manifest>\n  <spine>\n    <itemref idref="chap"/>\n  </spine>\n</package>`;

    const files = [
      {name:'mimetype', data:str2u8('application/epub+zip')}, // must be first, uncompressed
      {name:'META-INF/container.xml', data:str2u8(containerXml)},
      {name:'OEBPS/nav.xhtml', data:str2u8(navXhtml)},
      {name:'OEBPS/chapter.xhtml', data:str2u8(chapter)},
      {name:'OEBPS/content.opf', data:str2u8(opf)},
    ];
    const blob = zipStore(files);
    const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='DevDocs_Portal.epub'; a.click(); URL.revokeObjectURL(a.href);
  });

  function escapeHtml(s){ return (s||'').replace(/[&<>"]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
  function escapeXml(s){ return escapeHtml(s); }

})();
</script>
</body>
</html>
